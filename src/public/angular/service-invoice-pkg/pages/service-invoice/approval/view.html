<!-- Content Wrap -->
<form id="form" enctype="multipart-formdata" autocomplete="off">
<div class="content-wrap cndn-wrap">
    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-inner">
            <div class="page-header-content-left">
                <div class="page-header-content button-block">
                    <a href="#!/service-invoice-pkg/cn-dn/approval/approval-level/{{$ctrl.approval_type_id}}/list/" type="button" class="btn-back btn-img"><img class="img-responsive" src="./public/theme/img/content/previous.svg" alt="Back" /></a>
                </div><!-- Page Header Content -->
                <div class="page-header-content title-block">
                    <h1 class="title" ng-show="$ctrl.type_id == 1060"><b>{{$ctrl.action}} Credit Note</b></h1>
                    <h1 class="title" ng-show="$ctrl.type_id == 1061"><b>{{$ctrl.action}} Debit Note</b></h1>
                    <!-- <p class="subtitle">Service Item category List / Form</p> -->
                </div><!-- Page Header Content -->
            </div><!-- Page Header Content Left -->
        </div><!-- Page Header Inner -->
    </div><!-- Page Header -->
    <!-- <form id="form" enctype="multipart-formdata" autocomplete="off"> -->
        <input type="hidden" name="id" id="id" value="{{$ctrl.service_invoice.id}}">
        <input type="hidden" name="type_id" value="{{$ctrl.type_id}}">
        <input type="hidden" name="approval_type_id" id="approval_type_id" value="{{$ctrl.approval_type_id}}">
        <input type="hidden" name="current_status" id="current_status" value="{{$ctrl.service_invoice.status_id}}">
        <!-- Page Main Content -->
        <div class="page-main-content form-content type2">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="page-form pb-80">
                            <div class="flex-wrap">
                                <ul class="flex-list bordered">
                                    <li class="flex-md-4">
                                        <ul class="table-form-list">
                                            <li>
                                                <div class="table-form-list-wrap">
                                                    <label class="table-form-list-label">Branch</label>
                                                    <div class="table-form-list-control">
                                                        <input type="text" name="branch_id" value="{{$ctrl.service_invoice.branch.code}}" readonly>
                                                    </div><!-- Table Form List Control -->
                                                </div><!-- Table Form List Wrap -->
                                            </li>
                                            <li>
                                                <div class="table-form-list-wrap">
                                                    <label class="table-form-list-label">SBU</label>
                                                    <div class="table-form-list-control">
                                                        <input type="text" name="sbu_id" id="sbu_id" value="{{$ctrl.service_invoice.sbu.name}}" readonly>
                                                    </div><!-- Table Form List Control -->
                                                </div><!-- Table Form List Wrap -->
                                            </li>
                                            <li>
                                                <div class="table-form-list-wrap">
                                                    <label class="table-form-list-label">Category</label>
                                                    <div class="table-form-list-control">
                                                        <input type="text" name="category_id" id="category_id" value="{{$ctrl.service_invoice.service_item_sub_category.service_item_category.name}}" readonly>
                                                    </div><!-- Table Form List Control -->
                                                </div><!-- Table Form List Wrap -->
                                            </li>
                                            <li>
                                                <div class="table-form-list-wrap">
                                                    <label class="table-form-list-label">Sub Category</label>
                                                    <div class="table-form-list-control">
                                                        <input type="text" name="sub_category_id" id="sub_category_id" value="{{$ctrl.service_invoice.service_item_sub_category.name}}" readonly>
                                                    </div><!-- Table Form List Control -->
                                                </div><!-- Table Form List Wrap -->
                                            </li>
                                        </ul><!-- Table Form List -->
                                    </li>
                                    <li class="flex-md-4">
                                        <ul class="table-form-list">
                                            <li>
                                                <div class="table-form-list-wrap">
                                                    <label class="table-form-list-label">Invoice Date</label>
                                                    <div class="table-form-list-control">
                                                        <div class="input-group date type-sm">
                                                            <input name="invoice_date" type="text" class="form-control" placeholder="Select Invoice Date" ng-model="$ctrl.service_invoice.invoice_date" readonly />
                                                        </div><!-- Input Group -->
                                                    </div><!-- Table Form List Control -->
                                                </div><!-- Table Form List Wrap -->
                                            </li>
                                            <li>
                                                <div class="table-form-list-wrap">
                                                    <label class="table-form-list-label">Doc. Date</label>
                                                    <div class="table-form-list-control doc_date_error">
                                                        <div class="input-group date type-sm docDatePicker">
                                                            <input name="document_date" ng-model="$ctrl.service_invoice.document_date" type="text" class="form-control doc_date" placeholder="Select Doc Date" value="{{$ctrl.service_invoice.document_date}}" readonly />
                                                        </div><!-- Input Group -->
                                                    </div><!-- Table Form List Control -->
                                                </div><!-- Table Form List Wrap -->
                                            </li>
                                            <li>
                                                <div class="table-form-list-wrap">
                                                    <label class="table-form-list-label">Customer Code</label>
                                                    <div class="table-form-list-control">
                                                        <input type="text" name="customer_id" value="{{$ctrl.service_invoice.customer.code}}" readonly>
                                                    </div>
                                                </div><!-- Table Form List Wrap -->
                                            </li>
                                            <li>
                                                <span class="button-label">Ref Attachments</span>
                                                <div ng-repeat="(index, service_invoice_attachment) in $ctrl.service_invoice.attachments">
                                                    <div class="imageuploadify-container" data-attachment_id="{{service_invoice_attachment.id}}" style="margin-left: 0px; margin-right: 0px; ">
                                                        <div class="imageuploadify-details">
                                                            <span class="imageuploadify-file-name">{{service_invoice_attachment.name}}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul><!-- Table Form List -->
                                    </li>
                                    <li class="flex-md-4">
                                        <div class="info-wrap">
                                            <p class="info-content color-red right"><b>Invoice To</b></p>
                                            <p class="info-title" >{{$ctrl.service_invoice.customer.name}}</p>
                                            <p class="info-content-small italic">Customer Code : {{$ctrl.service_invoice.customer.code}}</p>
                                        </div><!-- Info Wrap -->
                                        <div class="info-wrap">
                                            <p class="info-content"><b>+ {{$ctrl.service_invoice.customer.mobile_no}}</b></p>
                                            <p class="info-content">{{$ctrl.service_invoice.customer.formatted_address}}</p>
                                            <div class="info-space"></div>
                                            <p class="info-content">GST # 234284738374847</p>
                                        </div><!-- Info Wrap -->
                                    </li>
                                </ul><!-- Flex List -->
                            </div><!-- Flex Wrap -->
                            <div class="table-wrap-header">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5 class="table-wrap-title">Invoice Details</h5>
                                    </div><!-- Column -->
                                </div><!-- Row -->
                            </div><!-- Table Wrap Header -->
                            <div class="table-wrap-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Item Code</th>
                                                <th>Item Name</th>
                                                <th>Reference</th>
                                                <th>Quantity</th>
                                                <th class="text-right">Rate</th>
                                                <th class="text-right">Amount</th>
                                                <th class="text-right" ng-repeat="(index, tax) in $ctrl.extras.tax_list">{{tax.name}}</th>
                                                <th class="text-right">Total Amount</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="(index, service_invoice_item) in $ctrl.service_invoice.service_invoice_items">
                                                <input type="hidden" name="service_invoice_items[{{index}}][id]" value="{{service_invoice_item.id}}">
                                                <input type="hidden" name="service_invoice_items[{{index}}][service_item_id]" value="{{service_invoice_item.service_item_id}}">
                                                <input type="hidden" name="service_invoice_items[{{index}}][description]" value="{{service_invoice_item.description}}">
                                                <input type="hidden" name="service_invoice_items[{{index}}][qty]" value="{{service_invoice_item.qty}}">
                                                <input type="hidden" name="service_invoice_items[{{index}}][rate]" value="{{service_invoice_item.rate}}">
                                                <input type="hidden" name="service_invoice_items[{{index}}][sub_total]" value="{{service_invoice_item.sub_total}}">
                                                <!-- FIELD GROUPS -->
                                                <td style="display: none;">
                                                    <span ng-repeat="(index_fg, field_group) in service_invoice_item.field_groups">
                                                        <input type="hidden" name="service_invoice_items[{{index}}][field_groups][{{index_fg}}][id]" value="{{field_group.id}}">
                                                        <span ng-repeat="(index_fd, field) in field_group.fields">
                                                            <input type="hidden" name="service_invoice_items[{{index}}][field_groups][{{index_fg}}][fields][{{index_fd}}][id]" value="{{field.id}}">
                                                            <input type="hidden" name="service_invoice_items[{{index}}][field_groups][{{index_fg}}][fields][{{index_fd}}][value]" value="{{field.value}}">
                                                        </span>
                                                    </span>
                                                </td>
                                                <td>{{service_invoice_item.code}}</td>
                                                <td>{{service_invoice_item.name}}</td>
                                                <td>{{service_invoice_item.description}}</td>
                                                <td>{{$ctrl.parseInt(service_invoice_item.qty)}}</td>
                                                <td class="text-right">{{service_invoice_item.rate | number : 2}}</td>
                                                <td class="text-right">{{service_invoice_item.sub_total | number : 2}}</td>
                                                <td class="text-right" ng-repeat="(tax_index, tax) in $ctrl.extras.tax_list">
                                                    {{(service_invoice_item[tax.name] ? (service_invoice_item[tax.name].amount | number : 2) : 0.00)}}({{(service_invoice_item[tax.name] ? (service_invoice_item[tax.name].percentage) : 0)}}%)
                                                    <input type="hidden" name="service_invoice_items[{{index}}][taxes][{{tax_index}}][tax_id]" value="{{tax.id}}">
                                                    <input type="hidden" name="service_invoice_items[{{index}}][taxes][{{tax_index}}][percentage]" value="{{(service_invoice_item[tax.name] ? service_invoice_item[tax.name].percentage : 0)}}">
                                                    <input type="hidden" name="service_invoice_items[{{index}}][taxes][{{tax_index}}][amount]" value="{{(service_invoice_item[tax.name] ? service_invoice_item[tax.name].amount : 0)}}">
                                                </td>
                                                <td class="text-right">{{service_invoice_item.total | number : 2}}</td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <th colspan="2"></th>
                                                <th>Total</th>
                                                <th>{{$ctrl.table_qty}}</th>
                                                <th>{{$ctrl.table_rate | number : 2}}</th>
                                                <th>{{$ctrl.table_sub_total | number : 2}}</th>
                                                <th ng-repeat="(index, tax) in $ctrl.extras.tax_list">{{$ctrl[tax.name+'_amount'] | number : 2}}</th>
                                                <th>{{$ctrl.table_total | number : 2}}</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div><!-- Table Wrap Body -->
                            <input type="hidden" name="service_invoice_item_removal_ids" id="service_invoice_item_removal_ids" value="">
                            <input type="hidden" name="items_count" value="{{$ctrl.service_invoice.service_invoice_items.length}}">
                            <input type="hidden" name="amount_total" value="{{$ctrl.table_sub_total}}">
                            <input type="hidden" name="tax_total" value="{{$ctrl.table_gst_total}}">
                            <input type="hidden" name="sub_total" value="{{$ctrl.table_sub_total}}">
                            <input type="hidden" name="total" value="{{$ctrl.table_total}}">
                            <input type="hidden" name="attachment_removal_ids" id="attachment_removal_ids" value="">
                            <div class="page-form-footer">
                                <div class="row">
                                    <div class="col-md-8 text-left">
                                        <ul class="form-footer-list">
                                            <li>
                                                <span class="form-footer-label">Total Quantity</span>
                                                <span class="form-footer-value" ng-if="$ctrl.table_qty">{{$ctrl.table_qty}}</span>
                                            </li>
                                            <li>
                                                <span class="form-footer-label">Total Amount</span>
                                                <span class="form-footer-value" ng-if="$ctrl.table_total">INR {{$ctrl.table_total | number : 2}} <small>({{$ctrl.table_sub_total | number : 2}} + {{$ctrl.table_gst_total | number : 2}} GST)</small></span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-md-4">
                                        <button type="button" class="btn btn-bordered" data-toggle="modal" data-target="#cancel_request_reject_modal">Reject</button>
                                        <button type="submit" id="approve" class="btn btn-primary">Approve</button>
                                    </div>
                                </div>
                            </div><!-- Page Form Footer -->
                        </div><!-- Page Form -->
                    </div><!-- Column -->
                </div><!-- Row -->
            </div><!-- Container -->
        </div><!-- Page Main Content -->
    <!-- </form> -->
</div><!-- Content Wrap -->
<script src="./public/theme/js/imageuploadify.min.js"></script>

<!-- Modal -->
<div class="modal fade filter" id="cancel_request_reject_modal" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close ripple reject_close" data-dismiss="modal" aria-label="Close"><i class="icon ion-md-close"></i></button>
                <h5 class="modal-title" id="myModalLabel">Reject</h5>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <label>Rejection Remarks<span class="mandatory">*</span></label>
                        <textarea rows="5" class="form-control rejection_remarks" placeholder="Enter Rejection Remarks" name="comments" value="" id="comments" autocomplete="off" minlength="3" maxlength="191"></textarea>
                    </div><!-- Field -->
                </div><!-- Column -->
                <div class="col-md-12 text-right mb-15">
                    <button type="button" data-dismiss="modal" class="btn btn-primary btn-bordered cancel_modal_btn">Cancel</button>
                    <button type="submit" id="reject" class="btn btn-bordered btn-red reject_btn">Reject</button>
                </div><!-- Column -->
            </div><!-- Row -->
        </div><!-- Modal Content -->
    </div><!-- Modal Dialog -->
</div><!-- Modal -->
</form>